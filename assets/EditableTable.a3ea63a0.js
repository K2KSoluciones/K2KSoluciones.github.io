import{F as k}from"./BackendConnection.3a543758.js";import{_ as f,L as w,o as r,c as d,b as n,t as m,F as g,n as N,a as b,r as C,e as _,i as v,h as L,d as F}from"./index.5c488590.js";import{P}from"./PageGenerator.78ad9ad0.js";const S={emits:["exportData"],data(){return{Lenguages:w}},methods:{exportFile(s,t){const e=[],u=[];k[t].fields.forEach(c=>u.push(c.placeholder)),e.push(u.join(",")+`
`),s.forEach(c=>{const y=[];k[t].fields.forEach(i=>{c[i.name]?y.push(c[i.name]):y.push("")}),e.push(y.join(",")+`
`)});const o=new Blob(e,{type:"application/text"}),l=document.createElement("a");l.href=URL.createObjectURL(o),l.download=t+"_export.csv",l.click(),URL.revokeObjectURL(l.href)}}},E=["title"],M=n("i",{class:"fa fa-file-export"},null,-1),B=[M],O={class:"dropdown-menu"};function U(s,t,e,u,o,l){return r(),d(g,null,[n("button",{type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.export,class:"btn text-light dropdown-toggle",style:{background:"#002133"}},B,8,E),n("ul",O,[n("li",null,[n("a",{class:"dropdown-item",href:"#",onClick:t[0]||(t[0]=c=>s.$emit("exportData",0))},m(this.Lenguages[this.Lenguages.selected].general.export_view),1)]),n("li",null,[n("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=c=>s.$emit("exportData",1))},m(this.Lenguages[this.Lenguages.selected].general.export_all),1)])])],64)}const Be=f(S,[["render",U]]),D={props:["moduleName"],emits:["importData"],data(){return{Lenguages:w}},methods:{importFile(s){const t=s.target.files,e=new FileReader;e.onload=u=>{const o=u.target.result;console.log(o)},e.readAsText(t[0])},downloadFile(){const s=[],t=[];k[this.moduleName].fields.forEach(o=>t.push(o.placeholder)),s.push(t.join(",")+`
`);const e=new Blob(s,{type:"application/text"}),u=document.createElement("a");u.href=URL.createObjectURL(e),u.download=this.moduleName+"_template.csv",u.click(),URL.revokeObjectURL(u.href)}}},G=["title"],R=n("i",{class:"fa fa-file-import"},null,-1),j=[R],I={class:"dropdown-menu"};function T(s,t,e,u,o,l){return r(),d(g,null,[n("input",{ref:"FileUpload",type:"file",accept:".csv",onChange:t[0]||(t[0]=(...c)=>l.importFile&&l.importFile(...c)),hidden:""},null,544),n("button",{type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.import,class:"btn text-light dropdown-toggle",style:{background:"#002133"}},j,8,G),n("ul",I,[n("li",null,[n("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=(...c)=>l.downloadFile&&l.downloadFile(...c))},m(this.Lenguages[this.Lenguages.selected].general.import_template),1)]),n("li",null,[n("a",{class:"dropdown-item",href:"#",onClick:t[2]||(t[2]=c=>s.$refs.FileUpload.click())},m(this.Lenguages[this.Lenguages.selected].general.import_file),1)])])],64)}const Oe=f(D,[["render",T]]),V={props:["moduleName","name","index","type","placeholder","value","target","validation","message"],emits:["cellChange","showMessage"],data(){return{error:!1,color:"rounded border border-success p-1"}},methods:{update(s){if(this.type=="checkbox")return this.$emit("cellChange",this.index,this.name,s.target.checked);if(this.type=="combobox")return this.$emit("cellChange",this.index,this.name,s.target.value);this.validation&&(this.error=!String(s.target.value).toLowerCase().match(this.validation)),this.error?this.color="rounded border border-danger p-1":this.color="rounded border border-warning p-1",this.error&&this.$emit("showMessage",this.message,"error"),this.$emit("cellChange",this.index,this.name,s.target.value)}}},z=["type","placeholder","value","id","checked"],A={key:0,class:"px-1"},q=["name","id"];function H(s,t,e,u,o,l){return r(),d("div",null,[n("input",{type:e.type,placeholder:e.placeholder,value:e.value,onChange:t[0]||(t[0]=(...c)=>l.update&&l.update(...c)),class:N(o.color),id:e.name,checked:e.value},null,42,z),e.type=="checkbox"?(r(),d("label",A,m(e.placeholder),1)):b("",!0),e.type=="button"?(r(),d("button",{key:1,name:e.name,id:e.index,onClick:t[1]||(t[1]=c=>s.$router.push("/"+s.ref)),class:"btn btn-secondary"},m(e.placeholder),9,q)):b("",!0)])}const J=f(V,[["render",H]]);const K={props:["token","user","moduleName","Model","models","fields","auxiliar","hasPermission"],emits:["showMessage","createOne","updateOne","deleteOne","changeStatus"],data(){return{model:{},Lenguages:w}},created(){this.clear()},computed:{display(){return this.models.length?this.$refs.PageGenerator.paginate(this.models):[]}},methods:{clear(){this.model=new this.Model({})},showMessage(s,t){this.$emit("showMessage",s,t)},onChange(s,t,e){if(s==-1)this.model[t]=e;else{const u=this.$refs.PageGenerator.getIndex(s);this.models[u][t]=e}},format(s,t,e){if(t){if(t=="datetime")return new Date(s).toLocaleString();if(t=="date")return new Date(s).toLocaleDateString();if(t=="time")return new Date(s).toLocaleTimeString();if(t=="checkbox")return s?"S\xED":"No";if(t=="combobox"||t=="status"){const u=this.auxiliar[e].find(o=>o._id===s);return u?u.name:s}else if(t=="multiple"){let u="";return s.forEach(o=>{const l=this.auxiliar[e].find(c=>c._id===o);l&&(u+=l.name+`
`)}),u}}else return s},sortBy(s,t=!1){this.models.sort((e,u)=>{let o=e[s].toLowerCase(),l=u[s].toLowerCase();return t?o<l?1:o>l?-1:0:o<l?-1:o>l?1:0})},updateSelect(s,t,e,u=!1){if(u){const o=[],l=document.getElementById("multiple"+s).options;for(const c of l)c.selected&&o.push(c.value);s!=-1?this.models[s][t]=o:this.model[t]=o}else s!=-1?this.models[this.$refs.PageGenerator.getIndex(s)][t]=e:this.model[t]=e},checkSelected(s,t,e){return e=="multiple"?t.find(u=>u==s):s==t}},components:{EditableCell:J,PageGenerator:P}},Q={class:"row mt-1"},W={class:"table table-striped mt-3"},X=n("th",null,null,-1),Y={class:"btn-group-vertical"},Z=["onClick"],$=n("i",{class:"fa-solid fa-arrow-up-a-z"},null,-1),ee=[$],te=["onClick"],se=n("i",{class:"fa-solid fa-arrow-down-z-a"},null,-1),oe=[se],ne={key:0},ae={class:"btn-group"},le=["title"],re=n("i",{class:"fa-solid fa-floppy-disk"},null,-1),ie=[re],de=["title"],ue=n("i",{class:"fa-solid fa-delete-left"},null,-1),ce=[ue],me=["name","multiple","id","onFocusout"],he=["value"],ge={class:"btn-group"},pe=["title","onClick"],_e=n("i",{class:"fa-solid fa-floppy-disk"},null,-1),be=[_e],ye=["title","onClick"],fe=n("i",{class:"fa-solid fa-trash"},null,-1),ke=[fe],we={key:0,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:"Cambiar estado",class:"btn text-light",style:{background:"#002133"}},Ce={class:"dropdown-menu"},ve=["onClick"],Le=["name","id","multiple","onFocusout"],xe=["value","selected"],Ne={key:3};function Fe(s,t,e,u,o,l){const c=C("EditableCell"),y=C("PageGenerator");return r(),d(g,null,[n("div",Q,[n("table",W,[n("thead",null,[n("tr",null,[X,(r(!0),d(g,null,_(e.fields,(i,h)=>(r(),d("th",{key:h,scope:"col"},[n("div",Y,[n("button",{onClick:a=>l.sortBy(i.name,!1),class:"btn btn-secundary btn-sm"},ee,8,Z),n("button",{onClick:a=>l.sortBy(i.name,!0),class:"btn btn-secundary btn-sm"},oe,8,te)]),v(" "+m(i.placeholder),1)]))),128))])]),n("tbody",null,[e.hasPermission(e.moduleName,"create")?(r(),d("tr",ne,[n("td",null,[n("div",ae,[e.hasPermission(e.moduleName,"create")?(r(),d("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.save,class:"btn btn-success",onClick:t[0]||(t[0]=i=>s.$emit("createOne",o.model))},ie,8,le)):b("",!0),n("button",{type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.clear,class:"btn btn-warning",onClick:t[1]||(t[1]=i=>o.model=new e.Model({}))},ce,8,de)])]),(r(!0),d(g,null,_(e.fields,(i,h)=>(r(),d("td",{key:h,scope:"row"},[i.type=="status"?(r(),d(g,{key:0},[],64)):i.type=="combobox"||i.type=="multiple"?(r(),d("select",{key:1,name:i.name,index:-1,multiple:i.type=="multiple",id:i.type+"-1",onFocusout:a=>l.updateSelect(-1,i.name,a.target.value,i.type=="multiple"),class:"rounded border border-dark"},[(r(!0),d(g,null,_(e.auxiliar[i.target],a=>(r(),d("option",{value:a._id},m(a.name),9,he))),256))],40,me)):i.type!="view"?(r(),L(c,{key:2,moduleName:e.moduleName,name:i.name,index:-1,type:i.type,placeholder:i.placeholder,value:o.model[i.name],validation:i.validation,message:i.message,onCellChange:l.onChange,onShowMessage:l.showMessage},null,8,["moduleName","name","type","placeholder","value","validation","message","onCellChange","onShowMessage"])):b("",!0)]))),128))])):b("",!0),(r(!0),d(g,null,_(l.display,(i,h)=>(r(),d("tr",{key:h},[n("td",null,[n("div",ge,[e.hasPermission(e.moduleName,"update")?(r(),d("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.save,class:"btn btn-success",onClick:a=>s.$emit("updateOne",s.$refs.PageGenerator.getIndex(h))},be,8,pe)):b("",!0),e.hasPermission(e.moduleName,"delete")?(r(),d("button",{key:1,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.delete,class:"btn btn-danger",onClick:a=>s.$emit("deleteOne",s.$refs.PageGenerator.getIndex(h))},ke,8,ye)):b("",!0)])]),(r(!0),d(g,null,_(e.fields,(a,x)=>(r(),d("td",{key:x,scope:"row"},[e.hasPermission(e.moduleName,"modify.status")&&a.type=="status"?(r(),d("button",we,[v(m(this.format(i[a.name],a.format,a.target))+" ",1),n("ul",Ce,[n("li",null,[(r(!0),d(g,null,_(e.auxiliar[a.target],p=>(r(),d("a",{onClick:Pe=>s.$emit("changeStatus",h,p._id),class:"dropdown-item"},m(p.name),9,ve))),256))])])])):e.hasPermission(e.moduleName,"modify."+a.name)&&(a.type=="combobox"||a.type=="multiple")?(r(),d("select",{key:1,name:a.name,id:a.type+h,multiple:a.type=="multiple",onFocusout:p=>l.updateSelect(h,a.name,p.target.value,a.type=="multiple"),class:"rounded border border-dark"},[(r(!0),d(g,null,_(e.auxiliar[a.target],p=>(r(),d("option",{value:p._id,selected:l.checkSelected(p._id,i[a.name],a.type)},m(p.name),9,xe))),256))],40,Le)):e.hasPermission(e.moduleName,"modify."+a.name)&&a.type!="view"?(r(),L(c,{key:2,moduleName:e.moduleName,name:a.name,index:h,type:a.type,placeholder:a.placeholder,value:i[a.name],validation:a.validation,message:a.message,onCellChange:l.onChange,onShowMessage:l.showMessage},null,8,["moduleName","name","index","type","placeholder","value","validation","message","onCellChange","onShowMessage"])):(r(),d("p",Ne,m(this.format(i[a.name],a.format,a.target)),1))]))),128))]))),128))])])]),F(y,{ref:"PageGenerator"},null,512)],64)}const Ue=f(K,[["render",Fe]]);export{Be as E,Oe as I,Ue as a};
