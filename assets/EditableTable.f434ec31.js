import{_ as w,o as a,c as r,d as u,n as P,t as _,a as p,L as S,r as f,F as g,f as b,i as k,h as C,e as v}from"./index.7ef4b25d.js";import{P as L}from"./PageGenerator.12460e32.js";const G={props:["moduleName","name","index","type","placeholder","value","target","validation","message","format"],emits:["cellChange","showMessage"],data(){return{error:!1,color:"rounded border border-success p-1"}},created(){this.fieldType=this.type,this.type=="date"&&this.index==-1&&(this.fieldType=this.type),this.type=="date"&&this.index!=-1&&(this.fieldType="text")},methods:{update(t){let e=t.target.value;if(this.type=="checkbox")return this.$emit("cellChange",this.index,this.name,t.target.checked);if(this.type=="combobox")return this.$emit("cellChange",this.index,this.name,e);this.validation&&(this.error=!String(t.target.value).toLowerCase().match(this.validation)),this.error?this.color="rounded border border-danger p-1":this.color="rounded border border-warning p-1",this.error&&this.$emit("showMessage",this.message,"error"),this.$emit("cellChange",this.index,this.name,e,this.format)},showFormatted(t){if(!t)return"";if(this.format){if(this.format=="datetime")return new Date(t).toLocaleString();if(this.format=="date"){const e=new Date(t);return isNaN(e.getTime())?"":(e.getMonth()+1<10?"0":"")+(e.getMonth()+1)+"/"+(e.getDate()<10?"0":"")+e.getDate()+"/"+e.getFullYear()}else return this.format=="time"?new Date(t).toLocaleTimeString():t}else return t}}},M=["type","placeholder","value","id","checked"],x={key:0,class:"px-1"},I=["name","id"];function T(t,e,o,d,l,i){return a(),r("div",null,[u("input",{type:t.fieldType,placeholder:o.placeholder,value:i.showFormatted(o.value),onChange:e[0]||(e[0]=(...m)=>i.update&&i.update(...m)),class:P(l.color),id:o.name,checked:o.value},null,42,M),t.fieldType=="checkbox"?(a(),r("label",x,_(o.placeholder),1)):p("",!0),t.fieldType=="button"?(a(),r("button",{key:1,name:o.name,id:o.index,onClick:e[1]||(e[1]=m=>t.$router.push("/"+t.ref)),class:"btn btn-secondary"},_(o.placeholder),9,I)):p("",!0)])}const j=w(G,[["render",T]]);const D={props:["token","user","moduleName","Model","models","fields","auxiliar","hasPermission"],emits:["showMessage","createOne","updateOne","deleteOne","changeStatus"],data(){return{model:{},Lenguages:S}},created(){this.clear()},computed:{display(){return this.models.length?this.$refs.PageGenerator.paginate(this.models):[]}},methods:{clear(){this.model=new this.Model({})},showMessage(t,e){this.$emit("showMessage",t,e)},onChange(t,e,o,d){if(o=this.format(o,d,null),t==-1)this.model[e]=o;else{const l=this.$refs.PageGenerator.getIndex(t);this.models[l][e]=o}},format(t,e,o){if(!t)return"";if(e){if(e=="datetime")return new Date(t).toLocaleString();if(e=="date"){const d=new Date(t);return isNaN(d.getTime())?(d.getMonth()+1<10?"0":"")+(d.getMonth()+1)+"/"+(d.getDate()<10?"0":"")+d.getDate()+"/"+d.getFullYear():""}else{if(e=="time")return new Date(t).toLocaleTimeString();if(e=="combobox"||e=="status"){const d=this.auxiliar[o].find(l=>l._id===t);return d?d.name:t}else if(e=="multiple"){let d="";return t.forEach(l=>{const i=this.auxiliar[o].find(m=>m._id===l);i&&(d+=i.name+`
`)}),d}else return t}}else return t},sortBy(t,e=!1){this.models.sort((o,d)=>{let l=o[t],i=d[t];return typeof l=="string"&&(l=l.toLowerCase()),typeof i=="string"&&(i=i.toLowerCase()),e?l<i?1:l>i?-1:0:l<i?-1:l>i?1:0})},updateSelect(t,e,o,d){if(d=="multijson"){e=="integrantes"?(t==-1&&this.model[e]==null&&(this.model[e]={integrantes:[]}),t!=-1&&this.models[this.$refs.PageGenerator.getIndex(t)][e]==null&&(this.models[this.$refs.PageGenerator.getIndex(t)][e]={integrantes:[]})):(e=="read_"||e=="create_"||e=="specific_"||e=="up_"||e=="delete_"||e=="importe_")&&(t==-1&&this.model[e]==null&&(this.model[e]={}),t!=-1&&this.models[this.$refs.PageGenerator.getIndex(t)][e]==null&&(this.models[this.$refs.PageGenerator.getIndex(t)][e]={}));let l="";const i=document.getElementById("multijson"+t).options;for(const n of i)n.selected&&(l=n.value);const m=l.split(") ")[0].replaceAll("(",""),y={};y[m]=l.split(") ")[1],e=="integrantes"?t!=-1?this.models[this.$refs.PageGenerator.getIndex(t)][e].integrantes.push(y):this.model[e].integrantes.push(y):(e=="read_"||e=="create_"||e=="specific_"||e=="up_"||e=="delete_"||e=="importe_")&&(t!=-1?this.models[this.$refs.PageGenerator.getIndex(t)][e][m]?this.models[this.$refs.PageGenerator.getIndex(t)][e][m].push(y):this.models[this.$refs.PageGenerator.getIndex(t)][e][m]=[y]:this.model[e][m]?this.model[e][m]+=","+y[m]:this.model[e]=y),console.log(this.model,e,m)}else if(d=="combojson"){const l=o.split(") ")[0].replaceAll("(",""),i={};i[l]=o.split(") ")[1],t!=-1?this.models[this.$refs.PageGenerator.getIndex(t)][e]=JSON.stringify(i):this.model[e]=JSON.stringify(i)}else d=="multiple"||(t!=-1?this.models[this.$refs.PageGenerator.getIndex(t)][e]=o:this.model[e]=o)},checkSelected(t,e,o){try{return e?o=="combobox"?t==e:o=="multiple"?e.find(d=>d==t):(e=JSON.parse(e),o=="multijson"?!1:e[t]!=null):!1}catch{return!1}}},components:{EditableCell:j,PageGenerator:L}},E={class:"row mt-1"},O={class:"table table-striped mt-3"},B={key:0},F={class:"btn-group-vertical"},V=["onClick"],z=u("i",{class:"fa-solid fa-arrow-up-a-z"},null,-1),J=[z],A=["onClick"],Y=u("i",{class:"fa-solid fa-arrow-down-z-a"},null,-1),q=[Y],H={key:0},K={class:"btn-group"},Q=["title"],R=u("i",{class:"fa-solid fa-floppy-disk"},null,-1),U=[R],W=["title"],X=u("i",{class:"fa-solid fa-delete-left"},null,-1),Z=[X],$=["name","multiple","id","onChange"],ee=["value"],te=["name","multiple","id","onChange"],se=["value"],oe={key:0},ne={class:"btn-group"},ae=["title","onClick"],re=u("i",{class:"fa-solid fa-floppy-disk"},null,-1),le=[re],ie=["title","onClick"],de=u("i",{class:"fa-solid fa-trash"},null,-1),ue=[de],ce={key:0,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:"Cambiar estado",class:"btn text-light",style:{background:"#002133"}},me={class:"dropdown-menu"},he=["onClick"],ge=["name","id","multiple","onChange"],_e=["value","selected"],ye=["name","id","multiple","onChange"],be=["value","selected"],pe={key:4};function fe(t,e,o,d,l,i){const m=f("EditableCell"),y=f("PageGenerator");return a(),r(g,null,[u("div",E,[u("table",O,[u("thead",null,[u("tr",null,[o.moduleName!="logs"?(a(),r("th",B)):p("",!0),(a(!0),r(g,null,b(o.fields,(n,h)=>(a(),r("th",{key:h,scope:"col"},[u("div",F,[u("button",{onClick:s=>i.sortBy(n.name,!1),class:"btn btn-secundary btn-sm"},J,8,V),u("button",{onClick:s=>i.sortBy(n.name,!0),class:"btn btn-secundary btn-sm"},q,8,A)]),k(" "+_(n.placeholder),1)]))),128))])]),u("tbody",null,[o.hasPermission(o.moduleName,"create")&&o.moduleName!="logs"?(a(),r("tr",H,[u("td",null,[u("div",K,[o.hasPermission(o.moduleName,"create")?(a(),r("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.save,class:"btn btn-success",onClick:e[0]||(e[0]=n=>t.$emit("createOne",l.model))},U,8,Q)):p("",!0),u("button",{type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.clear,class:"btn btn-warning",onClick:e[1]||(e[1]=n=>l.model=new o.Model({}))},Z,8,W)])]),(a(!0),r(g,null,b(o.fields,(n,h)=>(a(),r("td",{key:h,scope:"row"},[n.type=="status"?(a(),r(g,{key:0},[],64)):n.type=="combojson"||n.type=="multijson"?(a(),r("select",{key:1,name:n.name,index:-1,multiple:n.type=="multijson",id:n.type+"-1",onChange:s=>i.updateSelect(-1,n.name,s.target.value,n.type),class:"rounded border border-dark"},[(a(!0),r(g,null,b(o.auxiliar[n.target],s=>(a(),r("option",{value:"("+s.identification+") "+s.nombre},_("("+s.identification+") "+s.nombre),9,ee))),256))],40,$)):n.type=="combobox"||n.type=="multiple"?(a(),r("select",{key:2,name:n.name,index:-1,multiple:n.type=="multiple",id:n.type+"-1",onChange:s=>i.updateSelect(-1,n.name,s.target.value,n.type),class:"rounded border border-dark"},[(a(!0),r(g,null,b(o.auxiliar[n.target],s=>(a(),r("option",{value:"("+s.identification+") "+s.nombre},_("("+s.identification+") "+s.nombre),9,se))),256))],40,te)):n.type!="view"?(a(),C(m,{key:3,moduleName:o.moduleName,name:n.name,index:-1,type:n.type,placeholder:n.placeholder,value:l.model[n.name],validation:n.validation,message:n.message,onCellChange:i.onChange,onShowMessage:i.showMessage},null,8,["moduleName","name","type","placeholder","value","validation","message","onCellChange","onShowMessage"])):p("",!0)]))),128))])):p("",!0),(a(!0),r(g,null,b(i.display,(n,h)=>(a(),r("tr",{key:h},[o.moduleName!="logs"?(a(),r("td",oe,[u("div",ne,[o.hasPermission(o.moduleName,"update")?(a(),r("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.save,class:"btn btn-success",onClick:s=>t.$emit("updateOne",t.$refs.PageGenerator.getIndex(h))},le,8,ae)):p("",!0),o.hasPermission(o.moduleName,"delete")?(a(),r("button",{key:1,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.delete,class:"btn btn-danger",onClick:s=>t.$emit("deleteOne",t.$refs.PageGenerator.getIndex(h))},ue,8,ie)):p("",!0)])])):p("",!0),(a(!0),r(g,null,b(o.fields,(s,N)=>(a(),r("td",{key:N,scope:"row"},[o.hasPermission(o.moduleName,"modify.status")&&s.type=="status"?(a(),r("button",ce,[k(_(this.format(n[s.name],s.format,s.target))+" ",1),u("ul",me,[u("li",null,[(a(!0),r(g,null,b(o.auxiliar[s.target],c=>(a(),r("a",{onClick:ke=>t.$emit("changeStatus",h,c._id),class:"dropdown-item"},_(c.name),9,he))),256))])])])):o.hasPermission(o.moduleName,"modify."+s.name)&&(s.type=="combojson"||s.type=="multijson")&&!n[s.name]?(a(),r("select",{key:1,name:s.name,id:s.type+h,multiple:s.type=="multijson",onChange:c=>i.updateSelect(h,s.name,c.target.value,s.type),class:"rounded border border-dark"},[(a(!0),r(g,null,b(o.auxiliar[s.target],c=>(a(),r("option",{value:"("+c.identification+") "+c.nombre,selected:i.checkSelected(c.nombre,n[s.name],s.type)},_("("+c.identification+") "+c.nombre),9,_e))),256))],40,ge)):o.hasPermission(o.moduleName,"modify."+s.name)&&(s.type=="combobox"||s.type=="multiple")?(a(),r("select",{key:2,name:s.name,id:s.type+h,multiple:s.type=="multiple",onChange:c=>i.updateSelect(h,s.name,c.target.value,s.type),class:"rounded border border-dark"},[(a(!0),r(g,null,b(o.auxiliar[s.target],c=>(a(),r("option",{value:"("+c.identification+") "+c.nombre,selected:i.checkSelected("("+c.identification+") "+c.nombre,n[s.name],s.type)},_("("+c.identification+") "+c.nombre),9,be))),256))],40,ye)):o.hasPermission(o.moduleName,"modify."+s.name)&&s.type!="view"&&s.type!="combobox"&&s.type!="multiple"&&s.type!="combojson"&&s.type!="multijson"?(a(),C(m,{key:3,moduleName:o.moduleName,name:s.name,index:h,type:s.type,placeholder:s.placeholder,value:n[s.name],format:s.format,validation:s.validation,message:s.message,onCellChange:i.onChange,onShowMessage:i.showMessage},null,8,["moduleName","name","index","type","placeholder","value","format","validation","message","onCellChange","onShowMessage"])):(a(),r("p",pe,_(this.format(n[s.name],s.format,s.target)),1))]))),128))]))),128))])])]),v(y,{ref:"PageGenerator"},null,512)],64)}const Ne=w(D,[["render",fe]]);export{Ne as E};
