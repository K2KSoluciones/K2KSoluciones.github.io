import{_ as w,o as r,c as i,d as u,n as v,t as y,a as _,L as P,r as p,F as g,f as b,i as k,h as C,e as S}from"./index.15087d57.js";import{P as L}from"./PageGenerator.5664b64e.js";const M={props:["moduleName","name","index","type","placeholder","value","target","validation","message","format"],emits:["cellChange","showMessage"],data(){return{error:!1,color:"rounded border border-success p-1"}},methods:{update(e){let s=e.target.value;if(this.type=="checkbox")return this.$emit("cellChange",this.index,this.name,e.target.checked);if(this.type=="combobox")return this.$emit("cellChange",this.index,this.name,s);this.validation&&(this.error=!String(e.target.value).toLowerCase().match(this.validation)),this.error?this.color="rounded border border-danger p-1":this.color="rounded border border-warning p-1",this.error&&this.$emit("showMessage",this.message,"error"),this.$emit("cellChange",this.index,this.name,s,this.format)},showFormatted(e){if(!e)return"";if(this.format){if(this.format=="datetime")return new Date(e).toLocaleString();if(this.format=="date"){const s=new Date(e);if(isNaN(s.getTime()))return"";const t=(s.getMonth()+1<10?"0":"")+(s.getMonth()+1)+"/"+(s.getDate()<10?"0":"")+s.getDate()+"/"+s.getFullYear();return console.log(s,t),t}else return this.format=="time"?new Date(e).toLocaleTimeString():e}else return e}},mounted(){this.type!="date"?this.fieldType=this.type:this.fieldType="text"}},x=["type","placeholder","value","id","checked"],G={key:0,class:"px-1"},T=["name","id"];function D(e,s,t,d,o,a){return r(),i("div",null,[u("input",{type:e.fieldType,placeholder:t.placeholder,value:a.showFormatted(t.value),onChange:s[0]||(s[0]=(...h)=>a.update&&a.update(...h)),class:v(o.color),id:t.name,checked:t.value},null,42,x),e.fieldType=="checkbox"?(r(),i("label",G,y(t.placeholder),1)):_("",!0),e.fieldType=="button"?(r(),i("button",{key:1,name:t.name,id:t.index,onClick:s[1]||(s[1]=h=>e.$router.push("/"+e.ref)),class:"btn btn-secondary"},y(t.placeholder),9,T)):_("",!0)])}const E=w(M,[["render",D]]);const O={props:["token","user","moduleName","Model","models","fields","auxiliar","hasPermission"],emits:["showMessage","createOne","updateOne","deleteOne","changeStatus"],data(){return{model:{},Lenguages:P}},created(){this.clear()},computed:{display(){return this.models.length?this.$refs.PageGenerator.paginate(this.models):[]}},methods:{clear(){this.model=new this.Model({})},showMessage(e,s){this.$emit("showMessage",e,s)},onChange(e,s,t,d){if(t=this.format(t,d,null),e==-1)this.model[s]=t;else{const o=this.$refs.PageGenerator.getIndex(e);this.models[o][s]=t}},format(e,s,t){if(!e)return"";if(s){if(s=="datetime")return new Date(e).toLocaleString();if(s=="date"){const d=new Date(e);return isNaN(d.getTime())?(d.getMonth()+1<10?"0":"")+(d.getMonth()+1)+"/"+(d.getDate()<10?"0":"")+d.getDate()+"/"+d.getFullYear():""}else{if(s=="time")return new Date(e).toLocaleTimeString();if(s=="combobox"||s=="status"){const d=this.auxiliar[t].find(o=>o._id===e);return d?d.name:e}else if(s=="multiple"){let d="";return e.forEach(o=>{const a=this.auxiliar[t].find(h=>h._id===o);a&&(d+=a.name+`
`)}),d}else return e}}else return e},sortBy(e,s=!1){this.models.sort((t,d)=>{let o=t[e],a=d[e];return typeof o=="string"&&(o=o.toLowerCase()),typeof a=="string"&&(a=a.toLowerCase()),s?o<a?1:o>a?-1:0:o<a?-1:o>a?1:0})},updateSelect(e,s,t,d=!1){if(d){s=="integrantes"&&(e==-1&&this.model[s]==null&&(this.model[s]={integrantes:[]}),e!=-1&&this.models[this.$refs.PageGenerator.getIndex(e)][s]==null&&(this.models[this.$refs.PageGenerator.getIndex(e)][s]={integrantes:[]}));let o="";const a=document.getElementById("multiple"+e).options;for(const l of a)l.selected&&(o=l.value);const h=o.split(") ")[0].replaceAll("(",""),f={};f[h]=o.split(") ")[1],e!=-1?this.models[this.$refs.PageGenerator.getIndex(e)][s].integrantes.push(f):this.model[s].integrantes.push(f)}else{const o=t.split(") ")[0].replaceAll("(",""),a={};a[o]=t.split(") ")[1],e!=-1?this.models[this.$refs.PageGenerator.getIndex(e)][s]=JSON.stringify(a):this.model[s]=JSON.stringify(a)}},checkSelected(e,s,t){try{return!s||(s=JSON.parse(s),t=="multiple")?!1:s[e]!=null}catch{return!1}}},components:{EditableCell:E,PageGenerator:L}},B={class:"row mt-1"},I={class:"table table-striped mt-3"},F={key:0},V={class:"btn-group-vertical"},z=["onClick"],J=u("i",{class:"fa-solid fa-arrow-up-a-z"},null,-1),A=[J],Y=["onClick"],j=u("i",{class:"fa-solid fa-arrow-down-z-a"},null,-1),q=[j],H={key:0},K={class:"btn-group"},Q=["title"],R=u("i",{class:"fa-solid fa-floppy-disk"},null,-1),U=[R],W=["title"],X=u("i",{class:"fa-solid fa-delete-left"},null,-1),Z=[X],$=["name","multiple","id","onChange"],ee=["value"],te={key:0},se={class:"btn-group"},ne=["title","onClick"],oe=u("i",{class:"fa-solid fa-floppy-disk"},null,-1),ae=[oe],le=["title","onClick"],re=u("i",{class:"fa-solid fa-trash"},null,-1),ie=[re],de={key:0,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:"Cambiar estado",class:"btn text-light",style:{background:"#002133"}},ue={class:"dropdown-menu"},ce=["onClick"],me=["name","id","multiple","onChange"],he=["value","selected"],ge={key:3};function _e(e,s,t,d,o,a){const h=p("EditableCell"),f=p("PageGenerator");return r(),i(g,null,[u("div",B,[u("table",I,[u("thead",null,[u("tr",null,[t.moduleName!="logs"?(r(),i("th",F)):_("",!0),(r(!0),i(g,null,b(t.fields,(l,c)=>(r(),i("th",{key:c,scope:"col"},[u("div",V,[u("button",{onClick:n=>a.sortBy(l.name,!1),class:"btn btn-secundary btn-sm"},A,8,z),u("button",{onClick:n=>a.sortBy(l.name,!0),class:"btn btn-secundary btn-sm"},q,8,Y)]),k(" "+y(l.placeholder),1)]))),128))])]),u("tbody",null,[t.hasPermission(t.moduleName,"create")&&t.moduleName!="logs"?(r(),i("tr",H,[u("td",null,[u("div",K,[t.hasPermission(t.moduleName,"create")?(r(),i("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.save,class:"btn btn-success",onClick:s[0]||(s[0]=l=>e.$emit("createOne",o.model))},U,8,Q)):_("",!0),u("button",{type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.clear,class:"btn btn-warning",onClick:s[1]||(s[1]=l=>o.model=new t.Model({}))},Z,8,W)])]),(r(!0),i(g,null,b(t.fields,(l,c)=>(r(),i("td",{key:c,scope:"row"},[l.type=="status"?(r(),i(g,{key:0},[],64)):l.type=="combobox"||l.type=="multiple"?(r(),i("select",{key:1,name:l.name,index:-1,multiple:l.type=="multiple",id:l.type+"-1",onChange:n=>a.updateSelect(-1,l.name,n.target.value,l.type=="multiple"),class:"rounded border border-dark"},[(r(!0),i(g,null,b(t.auxiliar[l.target],n=>(r(),i("option",{value:"("+n.identification+") "+n.nombre},y("("+n.identification+") "+n.nombre),9,ee))),256))],40,$)):l.type!="view"?(r(),C(h,{key:2,moduleName:t.moduleName,name:l.name,index:-1,type:l.type,placeholder:l.placeholder,value:o.model[l.name],validation:l.validation,message:l.message,onCellChange:a.onChange,onShowMessage:a.showMessage},null,8,["moduleName","name","type","placeholder","value","validation","message","onCellChange","onShowMessage"])):_("",!0)]))),128))])):_("",!0),(r(!0),i(g,null,b(a.display,(l,c)=>(r(),i("tr",{key:c},[t.moduleName!="logs"?(r(),i("td",te,[u("div",se,[t.hasPermission(t.moduleName,"update")?(r(),i("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.save,class:"btn btn-success",onClick:n=>e.$emit("updateOne",e.$refs.PageGenerator.getIndex(c))},ae,8,ne)):_("",!0),t.hasPermission(t.moduleName,"delete")?(r(),i("button",{key:1,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:o.Lenguages[o.Lenguages.selected].general.delete,class:"btn btn-danger",onClick:n=>e.$emit("deleteOne",e.$refs.PageGenerator.getIndex(c))},ie,8,le)):_("",!0)])])):_("",!0),(r(!0),i(g,null,b(t.fields,(n,N)=>(r(),i("td",{key:N,scope:"row"},[t.hasPermission(t.moduleName,"modify.status")&&n.type=="status"?(r(),i("button",de,[k(y(this.format(l[n.name],n.format,n.target))+" ",1),u("ul",ue,[u("li",null,[(r(!0),i(g,null,b(t.auxiliar[n.target],m=>(r(),i("a",{onClick:ye=>e.$emit("changeStatus",c,m._id),class:"dropdown-item"},y(m.name),9,ce))),256))])])])):t.hasPermission(t.moduleName,"modify."+n.name)&&(n.type=="combobox"||n.type=="multiple")&&!l[n.name]?(r(),i("select",{key:1,name:n.name,id:n.type+c,multiple:n.type=="multiple",onChange:m=>a.updateSelect(c,n.name,m.target.value,n.type=="multiple"),class:"rounded border border-dark"},[(r(!0),i(g,null,b(t.auxiliar[n.target],m=>(r(),i("option",{value:"("+m.identification+") "+m.nombre,selected:a.checkSelected(m.nombre,l[n.name],n.type)},y("("+m.identification+") "+m.nombre),9,he))),256))],40,me)):t.hasPermission(t.moduleName,"modify."+n.name)&&n.type!="view"&&n.type!="combobox"&&n.type!="multiple"?(r(),C(h,{key:2,moduleName:t.moduleName,name:n.name,index:c,type:n.type,placeholder:n.placeholder,value:l[n.name],format:n.format,validation:n.validation,message:n.message,onCellChange:a.onChange,onShowMessage:a.showMessage},null,8,["moduleName","name","index","type","placeholder","value","format","validation","message","onCellChange","onShowMessage"])):(r(),i("p",ge,y(this.format(l[n.name],n.format,n.target)),1))]))),128))]))),128))])])]),S(f,{ref:"PageGenerator"},null,512)],64)}const pe=w(O,[["render",_e]]);export{pe as E};
