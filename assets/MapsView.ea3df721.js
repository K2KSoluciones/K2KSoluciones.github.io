import{A as k}from"./AlertMessage.cb97aba4.js";import{S as b}from"./SearchField.d415ac76.js";import{E as z,I as v}from"./ImportButton.76224113.js";import{_ as h,o as l,c as d,b as i,L as B,r as a,t as N,d as r,g as p,a as u,F as w}from"./index.b3591c9f.js";import{F as m,B as D}from"./BackendConnection.0f28079b.js";const S={props:["models","center","zoom"],emits:["updateModels"],data(){return{map:null,places:{},maps:[{name:"GoogleHybrid",url:"http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"GoogleSatellital",url:"http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"GoogleTerrain",url:"http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"OpenStreetMap",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xA9OpenStreetMap",subdomains:[]}],mapLayers:[],baseMaps:{},overlayMaps:{}}},created(){this.maps.forEach(t=>{const o=L.tileLayer(t.url,{attribution:t.attribution,subdomains:t.subdomains,maxZoom:20});this.mapLayers.push(o),this.baseMaps[t.name]=o})},watch:{models(){const t=L.icon({iconUrl:"https://img.icons8.com/fluency/16/null/place-marker.png",iconSize:[16,16]});if(this.places={},this.models.length>0){this.map&&(this.map.off(),this.map.remove()),this.models.forEach(e=>{if(e.latitude&&e.longitude){const c="("+e.id+') <a href="#">'+e.name+"</a><br>Latitud: "+e.latitude+"<br>Longitud: "+e.longitude;this.places[e.region]||(this.places[e.region]=[]),this.places[e.region].push(L.marker([e.latitude,e.longitude],{icon:t}).bindPopup(c))}});for(const e in this.places)this.places[e]=L.layerGroup(this.places[e]);const o=[...this.mapLayers];for(const e in this.places)o.push(this.places[e]);this.map=L.map("map",{center:this.center,zoom:this.zoom,layers:o});for(const e in this.places)this.overlayMaps[e]=this.places[e];L.control.layers(this.baseMaps,this.overlayMaps,{collapsed:!1}).addTo(this.map)}}}},E={class:"row mt-2"},C=i("div",{id:"map",class:"vh-80 p-1"},null,-1),F=[C];function A(t,o,e,c,s,n){return l(),d("div",E,F)}const G=h(S,[["render",A]]);const I={props:["token","user","hasPermission","updateToken"],data(){return{moduleName:"maps",title:m.maps.title,Model:m.maps.Model,fields:m.maps.fields,Lenguages:B,models:[],original:[],center:[],zoom:13}},created(){this.token?this.user?this.hasPermission(this.moduleName,"access")||this.$router.push("/"):this.$router.push("/"):this.$router.push("/")},methods:{showMessage(t,o){this.$refs.AlertMessage.show(t,o)},searchData(t){this.models=t},exportData(t=0){t==1?this.$refs.ExportButton.exportFile(this.original,this.moduleName):this.$refs.ExportButton.exportFile(this.models,this.moduleName)},async getData(t={zoom:10,latitude:4.60971,longitude:-74.08175}){this.zoom=t.zoom,this.center=[t.latitude,t.longitude];try{const o=await this.$refs.BackendConnection.getAll("lugares_get");console.log(o),this.original=o.resultados.map(e=>new this.Model(e)),this.models=this.original,this.updateToken({token:o.user.token,user:o.user})}catch(o){console.log(o),this.showMessage(this.Lenguages[this.Lenguages.selected].maps.err_get,"error")}}},components:{AlertMessage:k,SearchField:b,ExportButton:z,ImportButton:v,MapController:G,BackendConnection:D},mounted(){this.hasPermission(this.moduleName,"access")?navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{this.center=[t.coords.latitude,t.coords.longitude];const o={zoom:this.zoom,latitude:this.center[0],longitude:this.center[1]};this.getData(o)}):this.$router.push("/")}},P={class:"row pt-3 w-100"},T={class:"col"},V={id:"moduleTitle"},$={class:"col py-2"},O={class:"btn-group"};function U(t,o,e,c,s,n){const g=a("SearchField"),_=a("ExportButton"),f=a("ImportButton"),y=a("AlertMessage"),M=a("MapController"),x=a("BackendConnection");return l(),d(w,null,[i("div",P,[i("div",T,[i("h1",V,N(s.title),1)]),i("div",$,[i("div",O,[r(g,{original:s.original,onSearchData:n.searchData},null,8,["original","onSearchData"]),e.hasPermission(s.moduleName,"export")?(l(),p(_,{key:0,ref:"ExportButton",onExportData:n.exportData},null,8,["onExportData"])):u("",!0),e.hasPermission(s.moduleName,"import")?(l(),p(f,{key:1,moduleName:s.moduleName,onImportData:t.createOne},null,8,["moduleName","onImportData"])):u("",!0)])])]),r(y,{ref:"AlertMessage",class:"row pt-1"},null,512),r(M,{models:s.models,zoom:s.zoom,center:s.center,onUpdateModels:n.getData},null,8,["models","zoom","center","onUpdateModels"]),r(x,{token:e.token,user:e.user,moduleName:s.moduleName,ref:"BackendConnection",onShowMessage:n.showMessage},null,8,["token","user","moduleName","onShowMessage"])],64)}const K=h(I,[["render",U]]);export{K as default};
