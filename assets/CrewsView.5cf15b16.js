import{A as k,B}from"./BackendConnection.e0f21fa9.js";import{S as x}from"./SearchField.680eb6f0.js";import{E as M,I as L}from"./ImportButton.0480fb70.js";import{E as D}from"./EditableTable.11bcd250.js";import{F as l}from"./fields.e5b11a48.js";import{_ as N,L as y,r as n,o as c,c as C,b as r,t as A,d as i,g as h,a as u,F as O}from"./index.14abfc42.js";import"./PageGenerator.c640495f.js";const E={props:["token","user","hasPermission","updateToken"],data(){return{moduleName:"crews",title:l.crews.title,Model:l.crews.Model,fields:l.crews.fields,Lenguages:y,models:[],original:[],auxiliar:{}}},created(){this.token?this.user?this.hasPermission(this.moduleName,"access")||this.$router.push("/"):this.$router.push("/"):this.$router.push("/")},methods:{showMessage(t,e){this.$refs.AlertMessage.show(t,e)},searchData(t){this.models=t},exportData(t=0){t==1?this.$refs.ExportButton.exportFile(this.original,this.moduleName):this.$refs.ExportButton.exportFile(this.models,this.moduleName)},async getData(){try{const t=await this.$refs.BackendConnection.getAll("cuadrillas_get");this.original=t.resultados.map(s=>new this.Model(s)),this.models=this.original;for(let s=0;s<this.models.length;s++)try{this.models[s].integrantes=JSON.stringify(this.models[s].integrantes),this.models[s].integrantes=this.models[s].integrantes.replaceAll("&quot;",'"'),this.models[s].fecha_inicial=new Date(this.models[s].fecha_inicial).toLocaleDateString()}catch(o){console.log(o)}const e=await this.$refs.BackendConnection.getAllAuxiliar("personal2_lista",{perfil:"lider"}),a=await this.$refs.BackendConnection.getAllAuxiliar("personal2_lista",{perfil:"tecnico"}),d=await this.$refs.BackendConnection.getAllAuxiliar("personal2_lista",{perfil:"auxiliar"});this.auxiliar={leaders:e.resultados,people:[...a.resultados,...d.resultados]}}catch(t){console.log(t),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_get,"error")}},async createOne(t){try{t.integrantes=encodeURIComponent(t.integrantes),(await this.$refs.BackendConnection.createOne("cuadrillas_create",t)).codigoResultado==1&&this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_post,"success")}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_post,"error")}},async updateOne(t){try{const e=this.models[t];delete e.createdAt,delete e.createdBy,delete e.updatedAt,delete e.updatedBy;const a=await this.$refs.BackendConnection.updateOne("cuadrillas_up",e);this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_put,"success")}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_put,"error")}},async deleteOne(t){try{const e=window.prompt(this.Lenguages[this.Lenguages.selected].alerts.ask_delete,"");if(e==null||e=="")return;this.$refs.BackendConnection.deleteOne("cuadrillas_delete",this.models[t],e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_delete,"success"),this.getData()}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_delete,"error")}},async importData(t){try{const e=await this.$refs.BackendConnection.uploadFile("cuadrillas_imp",t)}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_post,"error")}}},components:{AlertMessage:k,SearchField:x,ExportButton:M,ImportButton:L,EditableTable:D,BackendConnection:B},mounted(){this.hasPermission(this.moduleName,"access")?this.getData():this.$router.push("/")}},S={class:"row pt-3 w-100"},F={class:"col"},b={id:"moduleTitle"},P={class:"col py-2"},I={class:"btn-group"};function v(t,e,a,d,s,o){const g=n("SearchField"),m=n("ExportButton"),p=n("ImportButton"),_=n("AlertMessage"),f=n("EditableTable"),w=n("BackendConnection");return c(),C(O,null,[r("div",S,[r("div",F,[r("h1",b,A(s.title),1)]),r("div",P,[r("div",I,[i(g,{original:s.original,onSearchData:o.searchData},null,8,["original","onSearchData"]),a.hasPermission(s.moduleName,"export")?(c(),h(m,{key:0,ref:"ExportButton",onExportData:o.exportData},null,8,["onExportData"])):u("",!0),a.hasPermission(s.moduleName,"import")?(c(),h(p,{key:1,moduleName:s.moduleName,onImportData:o.importData},null,8,["moduleName","onImportData"])):u("",!0)])])]),i(_,{ref:"AlertMessage",class:"row pt-1"},null,512),i(f,{token:a.token,user:a.user,moduleName:s.moduleName,Model:s.Model,fields:s.fields,models:s.models,auxiliar:s.auxiliar,hasPermission:a.hasPermission,onShowMessage:o.showMessage,onCreateOne:o.createOne,onUpdateOne:o.updateOne,onDeleteOne:o.deleteOne},null,8,["token","user","moduleName","Model","fields","models","auxiliar","hasPermission","onShowMessage","onCreateOne","onUpdateOne","onDeleteOne"]),i(w,{token:a.token,moduleName:s.moduleName,ref:"BackendConnection",onShowMessage:o.showMessage},null,8,["token","moduleName","onShowMessage"])],64)}const z=N(E,[["render",v]]);export{z as default};
