import{A as z}from"./AlertMessage.84bd585a.js";import{S as b}from"./SearchField.eb6fe141.js";import{E as w,I as k}from"./ImportButton.00007d52.js";import{_ as h,o as c,c as u,b as i,L as B,r,t as S,i as D,v as N,d as l,g as d,a as p,F as C}from"./index.7a9218e6.js";import{F as m,B as E}from"./BackendConnection.e2fe1e63.js";const F={props:["models","center","zoom"],emits:["updateModels"],data(){return{map:null,places:{},maps:[{name:"GoogleHybrid",url:"http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"GoogleSatellital",url:"http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"GoogleTerrain",url:"http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"OpenStreetMap",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xA9OpenStreetMap",subdomains:[]}],mapLayers:[],baseMaps:{},overlayMaps:{}}},created(){this.maps.forEach(e=>{const s=L.tileLayer(e.url,{attribution:e.attribution,subdomains:e.subdomains,maxZoom:20});this.mapLayers.push(s),this.baseMaps[e.name]=s})},watch:{models(){const e=L.icon({iconUrl:"https://img.icons8.com/emoji/48/null/red-triangle-pointed-up-emoji.png",iconSize:[16,16]});this.places={},this.models.length&&(this.map&&(this.map.off(),this.map.remove()),this.models.forEach(t=>{if(t.latitud&&t.longitud&&t.ident_id&&t.name&&t.region){const n="https://www.google.com/maps/@"+t.latitud+","+t.longitud+","+this.zoom+"z",o="https://www.google.com/maps/@"+t.latitud+","+t.longitud+",3a,75y,0.0h,90t",a="("+t.ident_id+') <a href="'+n+'" target="_blank">'+t.name+"</a><br>Latitud: "+t.latitud+"<br>Longitud: "+t.longitud+'<br><a href="'+o+'" target="_blank">How to arrive there?</a>';this.places[t.region]||(this.places[t.region]=[]),this.places[t.region].push(L.marker([t.latitud,t.longitud],{icon:e}).bindPopup(a))}}));for(const t in this.places)this.places[t]=L.layerGroup(this.places[t]);const s=[...this.mapLayers];for(const t in this.places)s.push(this.places[t]);this.map=L.map("map",{center:this.center,zoom:this.zoom,layers:s});for(const t in this.places)this.overlayMaps[t]=this.places[t];L.control.layers(this.baseMaps,this.overlayMaps,{collapsed:!1}).addTo(this.map),this.map.on("moveend",t=>{const n=t.target.getCenter().toString().replace("LatLng(","").replace(")","").split(", "),o={zoom:t.target.getZoom(),latitude:n[0],longitude:n[1]};this.$emit("updateModels",o)})}}},P={class:"row mt-2"},G=i("div",{id:"map",class:"vh-80 p-1"},null,-1),I=[G];function A(e,s,t,n,o,a){return c(),u("div",P,I)}const V=h(F,[["render",A]]);const T={props:["token","user","hasPermission","updateToken"],data(){return{moduleName:"maps",title:m.maps.title,Model:m.maps.Model,fields:m.maps.fields,Lenguages:B,models:[],original:[],center:[],zoom:15,limit:100}},created(){this.token?this.user?this.hasPermission(this.moduleName,"access")||this.$router.push("/"):this.$router.push("/"):this.$router.push("/")},methods:{showMessage(e,s){this.$refs.AlertMessage.show(e,s)},searchData(e){this.models=e},exportData(e=0){e==1?this.$refs.ExportButton.exportFile(this.original,this.moduleName):this.$refs.ExportButton.exportFile(this.models,this.moduleName)},async getData(e={zoom:10,latitude:"4.6097100",longitude:"-74.0817500"}){this.zoom=e.zoom,this.center=[e.latitude,e.longitude],e.zoom=1e5/((100*this.zoom^2)+1),e.limit=this.limit;try{const s=await this.$refs.BackendConnection.getParams("lugares_radio",e);console.log(s),this.original=s.resultados.map(t=>new this.Model(t)),this.models=this.original}catch(s){console.log(s),this.showMessage(this.Lenguages[this.Lenguages.selected].maps.err_get,"error")}}},components:{AlertMessage:z,SearchField:b,ExportButton:w,ImportButton:k,MapController:V,BackendConnection:E},mounted(){this.hasPermission(this.moduleName,"access")?navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.center=[e.coords.latitude.toString(),e.coords.longitude.toString()];const s={zoom:this.zoom,latitude:this.center[0],longitude:this.center[1]};this.getData(s)}):this.getData():this.$router.push("/")}},U={class:"row pt-3 w-100"},O={class:"col"},j={id:"moduleTitle"},H={class:"col py-2"},Z=["selected"],q=["selected"],J=["selected"],K=["selected"],Q=["selected"],R=["selected"],W={class:"btn-group"};function X(e,s,t,n,o,a){const g=r("SearchField"),_=r("ExportButton"),f=r("ImportButton"),y=r("AlertMessage"),M=r("MapController"),v=r("BackendConnection");return c(),u(C,null,[i("div",U,[i("div",O,[i("h1",j,S(o.title),1)]),i("div",H,[D(i("select",{"onUpdate:modelValue":s[0]||(s[0]=x=>o.limit=x),class:"rounded m-1 p-2"},[i("option",{value:"10",selected:o.limit==10},"10",8,Z),i("option",{value:"100",selected:o.limit==100},"100",8,q),i("option",{value:"200",selected:o.limit==200},"200",8,J),i("option",{value:"500",selected:o.limit==500},"500",8,K),i("option",{value:"1000",selected:o.limit==1e3},"1000",8,Q),i("option",{value:"100000",selected:o.limit>=101},"Todos",8,R)],512),[[N,o.limit]]),i("div",W,[l(g,{original:o.original,onSearchData:a.searchData},null,8,["original","onSearchData"]),t.hasPermission(o.moduleName,"export")?(c(),d(_,{key:0,ref:"ExportButton",onExportData:a.exportData},null,8,["onExportData"])):p("",!0),t.hasPermission(o.moduleName,"import")?(c(),d(f,{key:1,moduleName:o.moduleName,onImportData:e.createOne},null,8,["moduleName","onImportData"])):p("",!0)])])]),l(y,{ref:"AlertMessage",class:"row pt-1"},null,512),l(M,{models:o.models,zoom:o.zoom,center:o.center,onUpdateModels:a.getData},null,8,["models","zoom","center","onUpdateModels"]),l(v,{token:t.token,user:t.user,moduleName:o.moduleName,ref:"BackendConnection",onShowMessage:a.showMessage},null,8,["token","user","moduleName","onShowMessage"])],64)}const st=h(T,[["render",X]]);export{st as default};
