import{A as x,B as C}from"./BackendConnection.a14f85ad.js";import{S}from"./SearchField.d42a889b.js";import{E as B,I as D}from"./ImportButton.3f613699.js";import{E as L}from"./EditableTable.f434ec31.js";import{F as _}from"./fields.2aa84b71.js";import{_ as I,L as E,r as l,o as c,c as g,d as n,t as f,j as U,v as R,F as k,f as J,e as u,h as y,a as N}from"./index.7ef4b25d.js";import"./PageGenerator.12460e32.js";const v={props:["token","user","hasPermission","updateToken"],data(){return{moduleName:"profiles",title:_.profiles.title,Model:_.profiles.Model,fields:_.profiles.fields,Lenguages:E,models:[],original:[],auxiliar:[],profiles:[],profile:""}},created(){this.token?this.user?this.hasPermission(this.moduleName,"access")||this.$router.push("/"):this.$router.push("/"):this.$router.push("/")},methods:{showMessage(t,e){this.$refs.AlertMessage.show(t,e)},searchData(t){this.models=t},filterData(){if(this.profile.length){const t=[];this.original.forEach(e=>{e.profile==this.profile&&t.push(e)}),this.searchData(t)}else this.searchData(this.original)},exportData(t=0){t==1?this.$refs.ExportButton.exportFile(this.original,this.moduleName):this.$refs.ExportButton.exportFile(this.models,this.moduleName)},async getData(){try{const t=await this.$refs.BackendConnection.getAll("profile_get");this.original=this.models=t.resultados.map(s=>new this.Model(s));for(let s=0;s<this.models.length;s++)this.profiles.push(this.models[s].profile);const e=await this.$refs.BackendConnection.getAll("listar_permisos"),o={};o.read=e.metodos_get,o.specific=e.metodos_especificos,o.create=e.metodos_create,o.update=e.metodos_up,o.delete=e.metodos_delete,o.import=e.metodos_importe;const r=Object.keys(o);for(const s in r){this.auxiliar[r[s]]=[];const i=Object.keys(o[r[s]]);for(const d in i){const h=o[r[s]][i[d]].split(",");for(const p in h){const m={identification:i[d],nombre:h[p]};this.auxiliar[r[s]].push(m)}}}console.log(this.auxiliar)}catch(t){console.log(t),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_get,"error")}},async createOne(t){try{t.read_=JSON.stringify(t.read_),t.create_=JSON.stringify(t.create_),t.specific_=JSON.stringify(t.specific_),t.up_=JSON.stringify(t.up_),t.delete_=JSON.stringify(t.delete_),t.importe_=JSON.stringify(t.importe_),t.read_=encodeURIComponent(t.read_),t.create_=encodeURIComponent(t.create_),t.specific_=encodeURIComponent(t.specific_),t.up_=encodeURIComponent(t.up_),t.delete_=encodeURIComponent(t.delete_),t.importe_=encodeURIComponent(t.importe_),data.codigoResultado=="1"&&this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_post,"success")}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_post,"error")}},async updateOne(t){try{const e=this.models[t];delete e.createdAt,delete e.createdBy,delete e.updatedAt,delete e.updatedBy,e.read_=JSON.stringify(e.read_),e.create_=JSON.stringify(e.create_),e.specific_=JSON.stringify(e.specific_),e.up_=JSON.stringify(e.up_),e.delete_=JSON.stringify(e.delete_),e.importe_=JSON.stringify(e.importe_),e.read_=encodeURIComponent(e.read_),e.create_=encodeURIComponent(e.create_),e.specific_=encodeURIComponent(e.specific_),e.up_=encodeURIComponent(e.up_),e.delete_=encodeURIComponent(e.delete_),e.importe_=encodeURIComponent(e.importe_);const o=await this.$refs.BackendConnection.updateOne("profile_up",e);this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_put,"success")}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_put,"error")}},async deleteOne(t){try{const e=window.prompt(this.Lenguages[this.Lenguages.selected].alerts.ask_delete,"");if(e==null||e=="")return;this.$refs.BackendConnection.deleteOne("profile_delete",this.models[t],e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_delete,"success"),this.getData()}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_delete,"error")}}},components:{AlertMessage:x,SearchField:S,ExportButton:B,ImportButton:D,EditableTable:L,BackendConnection:C},mounted(){this.hasPermission(this.moduleName,"access")?this.getData():this.$router.push("/")}},b={class:"row pt-3 w-100"},A={class:"col"},F={id:"moduleTitle"},P={class:"col py-2"},T=n("option",{value:""},"Select one to filter",-1),V=["value"],j={class:"btn-group"};function q(t,e,o,r,s,i){const d=l("SearchField"),h=l("ExportButton"),p=l("ImportButton"),m=l("AlertMessage"),O=l("EditableTable"),w=l("BackendConnection");return c(),g(k,null,[n("div",b,[n("div",A,[n("h1",F,f(s.title),1)]),n("div",P,[U(n("select",{class:"rounded m-1 p-2",onChange:e[0]||(e[0]=(...a)=>i.filterData&&i.filterData(...a)),"onUpdate:modelValue":e[1]||(e[1]=a=>this.profile=a)},[T,(c(!0),g(k,null,J(s.profiles,(a,M)=>(c(),g("option",{key:M,value:a},f(a),9,V))),128))],544),[[R,this.profile]]),n("div",j,[u(d,{original:s.original,onSearchData:i.searchData},null,8,["original","onSearchData"]),o.hasPermission(s.moduleName,"export")?(c(),y(h,{key:0,ref:"ExportButton",onExportData:i.exportData},null,8,["onExportData"])):N("",!0),o.hasPermission(s.moduleName,"import")?(c(),y(p,{key:1,moduleName:s.moduleName,onImportData:i.createOne},null,8,["moduleName","onImportData"])):N("",!0)])])]),u(m,{ref:"AlertMessage",class:"row pt-1"},null,512),u(O,{token:o.token,user:o.user,moduleName:s.moduleName,Model:s.Model,fields:s.fields,models:s.models,auxiliar:s.auxiliar,hasPermission:o.hasPermission,onShowMessage:i.showMessage,onCreateOne:i.createOne,onUpdateOne:i.updateOne,onDeleteOne:i.deleteOne},null,8,["token","user","moduleName","Model","fields","models","auxiliar","hasPermission","onShowMessage","onCreateOne","onUpdateOne","onDeleteOne"]),u(w,{token:o.token,moduleName:s.moduleName,ref:"BackendConnection",onShowMessage:i.showMessage},null,8,["token","moduleName","onShowMessage"])],64)}const Y=I(v,[["render",q]]);export{Y as default};
