import{A as x,B as L}from"./BackendConnection.ecfc1fb4.js";import{S as N}from"./SearchField.df00062c.js";import{E as O,I as y}from"./ImportButton.5a174438.js";import{E}from"./EditableTable.a6313a6f.js";import{F as h}from"./fields.5d55b05c.js";import{_ as A,L as C,r,o as n,c,b as i,t as u,i as S,v,F as m,e as F,d,g,a as p}from"./index.0721faa3.js";import"./PageGenerator.8ed50f9f.js";const P={props:["token","user","hasPermission","updateToken"],data(){return{moduleName:"profiles",title:h.profiles.title,Model:h.profiles.Model,fields:h.profiles.fields,Lenguages:C,models:[],original:[],auxiliar:[],profiles:[],profile:""}},created(){this.token?this.user?this.hasPermission(this.moduleName,"access")||this.$router.push("/"):this.$router.push("/"):this.$router.push("/")},methods:{showMessage(s,e){this.$refs.AlertMessage.show(s,e)},searchData(s){this.models=s},filterData(){if(this.profile.length){const s=[];this.original.forEach(e=>{e.profile==this.profile&&s.push(e)}),this.searchData(s)}else this.searchData(this.original)},exportData(s=0){s==1?this.$refs.ExportButton.exportFile(this.original,this.moduleName):this.$refs.ExportButton.exportFile(this.models,this.moduleName)},async getData(){try{const s=await this.$refs.BackendConnection.getAll("profile_get");console.log(s),this.original=s.resultados.map(e=>new this.Model(e)),this.models=this.original;for(let e=0;e<this.models.length;e++)this.profiles.push(this.models[e].profile),this.models[e].read_=this.models[e].read_.replaceAll("&quot;",'"'),this.models[e].create_=this.models[e].create_.replaceAll("&quot;",'"'),this.models[e].update_=this.models[e].update_.replaceAll("&quot;",'"'),this.models[e].delete_=this.models[e].delete_.replaceAll("&quot;",'"')}catch(s){console.log(s),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_get,"error")}},async createOne(s){try{(await this.$refs.BackendConnection.createOne("profile_create",s)).codigoResultado=="1"&&this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_post,"success")}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_post,"error")}},async updateOne(s){try{const e=this.models[s];delete e.createdAt,delete e.createdBy,delete e.updatedAt,delete e.updatedBy;const a=await this.$refs.BackendConnection.updateOne("profile_up",e);this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_put,"success")}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_put,"error")}},async deleteOne(s){try{const e=window.prompt(this.Lenguages[this.Lenguages.selected].alerts.ask_delete,"");if(e==null||e=="")return;this.$refs.BackendConnection.deleteOne("profile_delete",this.models[s],e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.ok_delete,"success"),this.getData()}catch(e){console.log(e),this.showMessage(this.Lenguages[this.Lenguages.selected].alerts.err_delete,"error")}}},components:{AlertMessage:x,SearchField:N,ExportButton:O,ImportButton:y,EditableTable:E,BackendConnection:L},mounted(){this.hasPermission(this.moduleName,"access")?this.getData():this.$router.push("/")}},b={class:"row pt-3 w-100"},I={class:"col"},T={id:"moduleTitle"},V={class:"col py-2"},q=["value"],U={class:"btn-group"};function R(s,e,a,j,t,o){const f=r("SearchField"),_=r("ExportButton"),k=r("ImportButton"),w=r("AlertMessage"),M=r("EditableTable"),B=r("BackendConnection");return n(),c(m,null,[i("div",b,[i("div",I,[i("h1",T,u(t.title),1)]),i("div",V,[S(i("select",{class:"rounded m-1 p-2",onChange:e[0]||(e[0]=(...l)=>o.filterData&&o.filterData(...l)),"onUpdate:modelValue":e[1]||(e[1]=l=>this.profile=l)},[(n(!0),c(m,null,F(t.profiles,(l,D)=>(n(),c("option",{key:D,value:l},u(l),9,q))),128))],544),[[v,this.profile]]),i("div",U,[d(f,{original:t.original,onSearchData:o.searchData},null,8,["original","onSearchData"]),a.hasPermission(t.moduleName,"export")?(n(),g(_,{key:0,ref:"ExportButton",onExportData:o.exportData},null,8,["onExportData"])):p("",!0),a.hasPermission(t.moduleName,"import")?(n(),g(k,{key:1,moduleName:t.moduleName,onImportData:o.createOne},null,8,["moduleName","onImportData"])):p("",!0)])])]),d(w,{ref:"AlertMessage",class:"row pt-1"},null,512),d(M,{token:a.token,user:a.user,moduleName:t.moduleName,Model:t.Model,fields:t.fields,models:t.models,auxiliar:t.auxiliar,hasPermission:a.hasPermission,onShowMessage:o.showMessage,onCreateOne:o.createOne,onUpdateOne:o.updateOne,onDeleteOne:o.deleteOne},null,8,["token","user","moduleName","Model","fields","models","auxiliar","hasPermission","onShowMessage","onCreateOne","onUpdateOne","onDeleteOne"]),d(B,{token:a.token,moduleName:t.moduleName,ref:"BackendConnection",onShowMessage:o.showMessage},null,8,["token","moduleName","onShowMessage"])],64)}const X=A(P,[["render",R]]);export{X as default};
