import{_ as w,o as a,c as r,d,n as P,t as g,a as b,L as S,r as f,F as h,f as _,i as k,h as C,e as v}from"./index.36d29975.js";import{P as L}from"./PageGenerator.a37c01c8.js";const x={props:["moduleName","name","index","type","placeholder","value","target","validation","message","format"],emits:["cellChange","showMessage"],data(){return{error:!1,color:"rounded border border-success p-1"}},created(){this.fieldType=this.type,this.type=="date"&&this.index==-1&&(this.fieldType=this.type),this.type=="date"&&this.index!=-1&&(this.fieldType="text")},methods:{update(s){let n=s.target.value;if(this.type=="checkbox")return this.$emit("cellChange",this.index,this.name,s.target.checked);if(this.type=="combobox")return this.$emit("cellChange",this.index,this.name,n);this.validation&&(this.error=!String(s.target.value).toLowerCase().match(this.validation)),this.error?this.color="rounded border border-danger p-1":this.color="rounded border border-warning p-1",this.error&&this.$emit("showMessage",this.message,"error"),this.$emit("cellChange",this.index,this.name,n,this.format)},showFormatted(s){if(!s)return"";if(this.format){if(this.format=="datetime")return new Date(s).toLocaleString();if(this.format=="date"){const n=new Date(s);return isNaN(n.getTime())?"":(n.getMonth()+1<10?"0":"")+(n.getMonth()+1)+"/"+(n.getDate()<10?"0":"")+n.getDate()+"/"+n.getFullYear()}else return this.format=="time"?new Date(s).toLocaleTimeString():s}else return s}}},M=["type","placeholder","value","id","checked"],G={key:0,class:"px-1"},T=["name","id"];function j(s,n,t,u,l,i){return a(),r("div",null,[d("input",{type:s.fieldType,placeholder:t.placeholder,value:i.showFormatted(t.value),onChange:n[0]||(n[0]=(...y)=>i.update&&i.update(...y)),class:P(l.color),id:t.name,checked:t.value},null,42,M),s.fieldType=="checkbox"?(a(),r("label",G,g(t.placeholder),1)):b("",!0),s.fieldType=="button"?(a(),r("button",{key:1,name:t.name,id:t.index,onClick:n[1]||(n[1]=y=>s.$router.push("/"+s.ref)),class:"btn btn-secondary"},g(t.placeholder),9,T)):b("",!0)])}const D=w(x,[["render",j]]);const E={props:["token","user","moduleName","Model","models","fields","auxiliar","hasPermission"],emits:["showMessage","createOne","updateOne","deleteOne","changeStatus"],data(){return{model:{},Lenguages:S}},created(){this.clear()},computed:{display(){return this.models.length?this.$refs.PageGenerator.paginate(this.models):[]}},methods:{clear(){this.model=new this.Model({})},showMessage(s,n){this.$emit("showMessage",s,n)},onChange(s,n,t,u){if(t=this.format(t,u,null),s==-1)this.model[n]=t;else{const l=this.$refs.PageGenerator.getIndex(s);this.models[l][n]=t}},format(s,n,t){if(!s)return"";if(n){if(n=="datetime")return new Date(s).toLocaleString();if(n=="date"){const u=new Date(s);return isNaN(u.getTime())?(u.getMonth()+1<10?"0":"")+(u.getMonth()+1)+"/"+(u.getDate()<10?"0":"")+u.getDate()+"/"+u.getFullYear():""}else{if(n=="time")return new Date(s).toLocaleTimeString();if(n=="combobox"||n=="status"){const u=this.auxiliar[t].find(l=>l._id===s);return u?u.name:s}else if(n=="multiple"){let u="";return s.forEach(l=>{const i=this.auxiliar[t].find(y=>y._id===l);i&&(u+=i.name+`
`)}),u}else return s}}else return s},sortBy(s,n=!1){this.models.sort((t,u)=>{let l=t[s],i=u[s];return typeof l=="string"&&(l=l.toLowerCase()),typeof i=="string"&&(i=i.toLowerCase()),n?l<i?1:l>i?-1:0:l<i?-1:l>i?1:0})},updateSelect(s,n,t,u){if(u=="multijson"){n=="integrantes"&&(s==-1&&this.model[n]==null&&(this.model[n]={integrantes:[]}),s!=-1&&this.models[this.$refs.PageGenerator.getIndex(s)][n]==null&&(this.models[this.$refs.PageGenerator.getIndex(s)][n]={integrantes:[]}));let l="";const i=document.getElementById("multiple"+s).options;for(const o of i)o.selected&&(l=o.value);const y=l.split(") ")[0].replaceAll("(",""),p={};p[y]=l.split(") ")[1],s!=-1?this.models[this.$refs.PageGenerator.getIndex(s)][n].integrantes.push(p):this.model[n].integrantes.push(p)}else if(u=="combojson"){const l=t.split(") ")[0].replaceAll("(",""),i={};i[l]=t.split(") ")[1],s!=-1?this.models[this.$refs.PageGenerator.getIndex(s)][n]=JSON.stringify(i):this.model[n]=JSON.stringify(i)}else u=="multiple"||(s!=-1?this.models[this.$refs.PageGenerator.getIndex(s)][n]=t:this.model[n]=t)},checkSelected(s,n,t){try{return n?t=="combobox"?s==n:t=="multiple"?n.find(u=>u==s):(n=JSON.parse(n),t=="multijson"?!1:n[s]!=null):!1}catch{return!1}}},components:{EditableCell:D,PageGenerator:L}},I={class:"row mt-1"},O={class:"table table-striped mt-3"},B={key:0},F={class:"btn-group-vertical"},V=["onClick"],z=d("i",{class:"fa-solid fa-arrow-up-a-z"},null,-1),J=[z],A=["onClick"],Y=d("i",{class:"fa-solid fa-arrow-down-z-a"},null,-1),q=[Y],H={key:0},K={class:"btn-group"},Q=["title"],R=d("i",{class:"fa-solid fa-floppy-disk"},null,-1),U=[R],W=["title"],X=d("i",{class:"fa-solid fa-delete-left"},null,-1),Z=[X],$=["name","multiple","id","onChange"],ee=["value"],te=["name","multiple","id","onChange"],se=["value"],ne={key:0},oe={class:"btn-group"},ae=["title","onClick"],re=d("i",{class:"fa-solid fa-floppy-disk"},null,-1),le=[re],ie=["title","onClick"],ue=d("i",{class:"fa-solid fa-trash"},null,-1),de=[ue],ce={key:0,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:"Cambiar estado",class:"btn text-light",style:{background:"#002133"}},me={class:"dropdown-menu"},he=["onClick"],ge=["name","id","multiple","onChange"],ye=["value","selected"],_e=["name","id","multiple","onChange"],be=["value","selected"],pe={key:4};function fe(s,n,t,u,l,i){const y=f("EditableCell"),p=f("PageGenerator");return a(),r(h,null,[d("div",I,[d("table",O,[d("thead",null,[d("tr",null,[t.moduleName!="logs"?(a(),r("th",B)):b("",!0),(a(!0),r(h,null,_(t.fields,(o,m)=>(a(),r("th",{key:m,scope:"col"},[d("div",F,[d("button",{onClick:e=>i.sortBy(o.name,!1),class:"btn btn-secundary btn-sm"},J,8,V),d("button",{onClick:e=>i.sortBy(o.name,!0),class:"btn btn-secundary btn-sm"},q,8,A)]),k(" "+g(o.placeholder),1)]))),128))])]),d("tbody",null,[t.hasPermission(t.moduleName,"create")&&t.moduleName!="logs"?(a(),r("tr",H,[d("td",null,[d("div",K,[t.hasPermission(t.moduleName,"create")?(a(),r("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.save,class:"btn btn-success",onClick:n[0]||(n[0]=o=>s.$emit("createOne",l.model))},U,8,Q)):b("",!0),d("button",{type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.clear,class:"btn btn-warning",onClick:n[1]||(n[1]=o=>l.model=new t.Model({}))},Z,8,W)])]),(a(!0),r(h,null,_(t.fields,(o,m)=>(a(),r("td",{key:m,scope:"row"},[o.type=="status"?(a(),r(h,{key:0},[],64)):o.type=="combojson"||o.type=="multijson"?(a(),r("select",{key:1,name:o.name,index:-1,multiple:o.type=="multijson",id:o.type+"-1",onChange:e=>i.updateSelect(-1,o.name,e.target.value,o.type),class:"rounded border border-dark"},[(a(!0),r(h,null,_(t.auxiliar[o.target],e=>(a(),r("option",{value:"("+e.identification+") "+e.nombre},g("("+e.identification+") "+e.nombre),9,ee))),256))],40,$)):o.type=="combobox"||o.type=="multiple"?(a(),r("select",{key:2,name:o.name,index:-1,multiple:o.type=="multiple",id:o.type+"-1",onChange:e=>i.updateSelect(-1,o.name,e.target.value,o.type),class:"rounded border border-dark"},[(a(!0),r(h,null,_(t.auxiliar[o.target],e=>(a(),r("option",{value:"("+e.identification+") "+e.nombre},g("("+e.identification+") "+e.nombre),9,se))),256))],40,te)):o.type!="view"?(a(),C(y,{key:3,moduleName:t.moduleName,name:o.name,index:-1,type:o.type,placeholder:o.placeholder,value:l.model[o.name],validation:o.validation,message:o.message,onCellChange:i.onChange,onShowMessage:i.showMessage},null,8,["moduleName","name","type","placeholder","value","validation","message","onCellChange","onShowMessage"])):b("",!0)]))),128))])):b("",!0),(a(!0),r(h,null,_(i.display,(o,m)=>(a(),r("tr",{key:m},[t.moduleName!="logs"?(a(),r("td",ne,[d("div",oe,[t.hasPermission(t.moduleName,"update")?(a(),r("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.save,class:"btn btn-success",onClick:e=>s.$emit("updateOne",s.$refs.PageGenerator.getIndex(m))},le,8,ae)):b("",!0),t.hasPermission(t.moduleName,"delete")?(a(),r("button",{key:1,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:l.Lenguages[l.Lenguages.selected].general.delete,class:"btn btn-danger",onClick:e=>s.$emit("deleteOne",s.$refs.PageGenerator.getIndex(m))},de,8,ie)):b("",!0)])])):b("",!0),(a(!0),r(h,null,_(t.fields,(e,N)=>(a(),r("td",{key:N,scope:"row"},[t.hasPermission(t.moduleName,"modify.status")&&e.type=="status"?(a(),r("button",ce,[k(g(this.format(o[e.name],e.format,e.target))+" ",1),d("ul",me,[d("li",null,[(a(!0),r(h,null,_(t.auxiliar[e.target],c=>(a(),r("a",{onClick:ke=>s.$emit("changeStatus",m,c._id),class:"dropdown-item"},g(c.name),9,he))),256))])])])):t.hasPermission(t.moduleName,"modify."+e.name)&&(e.type=="combojson"||e.type=="multijson")&&!o[e.name]?(a(),r("select",{key:1,name:e.name,id:e.type+m,multiple:e.type=="multijson",onChange:c=>i.updateSelect(m,e.name,c.target.value,e.type),class:"rounded border border-dark"},[(a(!0),r(h,null,_(t.auxiliar[e.target],c=>(a(),r("option",{value:"("+c.identification+") "+c.nombre,selected:i.checkSelected(c.nombre,o[e.name],e.type)},g("("+c.identification+") "+c.nombre),9,ye))),256))],40,ge)):t.hasPermission(t.moduleName,"modify."+e.name)&&(e.type=="combobox"||e.type=="multiple")?(a(),r("select",{key:2,name:e.name,id:e.type+m,multiple:e.type=="multiple",onChange:c=>i.updateSelect(m,e.name,c.target.value,e.type),class:"rounded border border-dark"},[(a(!0),r(h,null,_(t.auxiliar[e.target],c=>(a(),r("option",{value:"("+c.identification+") "+c.nombre,selected:i.checkSelected("("+c.identification+") "+c.nombre,o[e.name],e.type)},g("("+c.identification+") "+c.nombre),9,be))),256))],40,_e)):t.hasPermission(t.moduleName,"modify."+e.name)&&e.type!="view"&&e.type!="combobox"&&e.type!="multiple"&&e.type!="combojson"&&e.type!="multijson"?(a(),C(y,{key:3,moduleName:t.moduleName,name:e.name,index:m,type:e.type,placeholder:e.placeholder,value:o[e.name],format:e.format,validation:e.validation,message:e.message,onCellChange:i.onChange,onShowMessage:i.showMessage},null,8,["moduleName","name","index","type","placeholder","value","format","validation","message","onCellChange","onShowMessage"])):(a(),r("p",pe,g(this.format(o[e.name],e.format,e.target)),1))]))),128))]))),128))])])]),v(p,{ref:"PageGenerator"},null,512)],64)}const Ne=w(E,[["render",fe]]);export{Ne as E};
